<div class="query-browser-container">
  <mat-toolbar class="toolbar">
    <span class="toolbar-title">Query Browser</span>
    <span class="spacer"></span>
    <button mat-button (click)="createFolder()">
      <mat-icon>create_new_folder</mat-icon>
      New Folder
    </button>
    <button mat-raised-button color="primary" (click)="createQuery()">
      <mat-icon>add</mat-icon>
      New Query
    </button>
  </mat-toolbar>

  <div class="content-area">
    <div class="sidebar">
      <mat-card class="tree-card">
        <mat-card-header>
          <mat-card-title>Folders & Queries</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <mat-tree [dataSource]="dataSource" [treeControl]="treeControl">
            <mat-tree-node *matTreeNodeDef="let node" matTreeNodePadding [style.padding-left.px]="node.level * 20">
              <button mat-icon-button disabled></button>
              <mat-icon class="tree-icon" [class.query-icon]="node.type === 'query'">
                {{ node.type === 'folder' ? 'folder' : 'description' }}
              </mat-icon>
              <span class="tree-label" (click)="selectItem(node)" [class.selected]="selectedItem?.id === node.id">
                {{ node.name }}
              </span>
              <button mat-icon-button [matMenuTriggerFor]="menu" class="tree-menu" (click)="$event.stopPropagation()">
                <mat-icon>more_vert</mat-icon>
              </button>
              <mat-menu #menu="matMenu">
                <button mat-menu-item (click)="editItem(node)">
                  <mat-icon>edit</mat-icon>
                  Edit
                </button>
                <button mat-menu-item (click)="moveItem(node)">
                  <mat-icon>drive_file_move</mat-icon>
                  Move
                </button>
                <button mat-menu-item (click)="deleteItem(node)">
                  <mat-icon>delete</mat-icon>
                  Delete
                </button>
              </mat-menu>
            </mat-tree-node>

            <mat-tree-node *matTreeNodeDef="let node; when: hasChild" matTreeNodePadding [style.padding-left.px]="node.level * 20">
              <button mat-icon-button matTreeNodeToggle [attr.aria-label]="'toggle ' + node.name">
                <mat-icon>{{ treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right' }}</mat-icon>
              </button>
              <mat-icon class="tree-icon folder-icon">folder</mat-icon>
              <span class="tree-label" (click)="selectItem(node)" [class.selected]="selectedItem?.id === node.id">
                {{ node.name }}
              </span>
              <button mat-icon-button [matMenuTriggerFor]="menu" class="tree-menu" (click)="$event.stopPropagation()">
                <mat-icon>more_vert</mat-icon>
              </button>
              <mat-menu #menu="matMenu">
                <button mat-menu-item (click)="editItem(node)">
                  <mat-icon>edit</mat-icon>
                  Rename
                </button>
                <button mat-menu-item (click)="moveItem(node)">
                  <mat-icon>drive_file_move</mat-icon>
                  Move
                </button>
                <button mat-menu-item (click)="deleteItem(node)">
                  <mat-icon>delete</mat-icon>
                  Delete
                </button>
              </mat-menu>
            </mat-tree-node>
          </mat-tree>
        </mat-card-content>
      </mat-card>
    </div>

    <div class="main-content">
      <div class="empty-state" *ngIf="!selectedItem">
        <mat-icon class="empty-icon">search</mat-icon>
        <h2>Select a Query</h2>
        <p>Choose a query or folder from the sidebar to view details</p>
      </div>

      <mat-card class="query-detail" *ngIf="selectedItem && selectedItem.type === 'query'">
        <mat-card-header>
          <mat-icon mat-card-avatar>description</mat-icon>
          <mat-card-title>{{ selectedItem.name }}</mat-card-title>
          <mat-card-subtitle>Query â€¢ Updated {{ selectedItem.updatedAt | date:'short' }}</mat-card-subtitle>
        </mat-card-header>
        
        <mat-card-content>
          <div class="query-meta">
            <div class="author">
              <mat-icon>person</mat-icon>
              <span>{{ selectedItem.author }}</span>
            </div>
            <div class="tags" *ngIf="selectedItem.tags && selectedItem.tags.length > 0">
              <mat-chip-set>
                <mat-chip *ngFor="let tag of selectedItem.tags">{{ tag }}</mat-chip>
              </mat-chip-set>
            </div>
          </div>
          
          <div class="query-content">
            <h3>SQL Query</h3>
            <pre><code>{{ selectedItem.content }}</code></pre>
          </div>
        </mat-card-content>
        
        <mat-card-actions>
          <button mat-button>
            <mat-icon>play_arrow</mat-icon>
            Run Query
          </button>
          <button mat-button>
            <mat-icon>edit</mat-icon>
            Edit
          </button>
          <button mat-button>
            <mat-icon>share</mat-icon>
            Share
          </button>
        </mat-card-actions>
      </mat-card>

      <mat-card class="folder-detail" *ngIf="selectedItem && selectedItem.type === 'folder'">
        <mat-card-header>
          <mat-icon mat-card-avatar>folder</mat-icon>
          <mat-card-title>{{ selectedItem.name }}</mat-card-title>
          <mat-card-subtitle>Folder</mat-card-subtitle>
        </mat-card-header>
        
        <mat-card-content>
          <p>This folder contains queries and subfolders. Expand it in the sidebar to explore its contents.</p>
        </mat-card-content>
        
        <mat-card-actions>
          <button mat-button (click)="createQuery()">
            <mat-icon>add</mat-icon>
            Add Query
          </button>
          <button mat-button (click)="createFolder()">
            <mat-icon>create_new_folder</mat-icon>
            Add Subfolder
          </button>
        </mat-card-actions>
      </mat-card>
    </div>
  </div>
</div>
